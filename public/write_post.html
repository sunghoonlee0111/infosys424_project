<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <title>Habitat for Humanity</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Covered+By+Your+Grace&family=Manrope:wght@200..800&display=swap"
      rel="stylesheet"
    />

    <!-- Include stylesheet -->
    <link
      href="https://cdn.jsdelivr.net/npm/quill@2.0.0-rc.4/dist/quill.snow.css"
      rel="stylesheet"
    />
  </head>

  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-storage.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-firestore.js"></script>

  <body>
    <!-- header -->
    <header>
      <div class="header max_width_1920">
        <!-- navbar -->
        <nav class="navbar" role="navigation" aria-label="main navigation">
          <div class="navbar-brand">
            <a href="index.html" class="nav_logo"></a>
            <a
              role="button"
              class="navbar-burger"
              id="burger_nav"
              aria-label="menu"
              aria-expanded="false"
              data-target="navbarBasicExample"
            >
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
            </a>
          </div>
          <div class="navbar-menu" id="menu_nav">
            <div class="navbar-start">
              <a href="index.html" class="navbar-item">HOME</a>
              <a href="about.html" class="navbar-item">ABOUT</a>
              <a href="gallery.html" class="navbar-item">GALLERY</a>
              <a href="post.html" class="navbar-item">POST</a>
              <a href="event.html" class="navbar-item">EVENT</a>
            </div>
            <div class="navbar-end">
              <div class="nav_signin navbar-item">
                <button
                  class="button has-text-black is-rounded"
                  id="user_signin"
                >
                  Sign In
                </button>
              </div>
              <div class="navbar-item">
                <button
                  class="nav_signup button has-text-black is-rounded main-color"
                  id="user_signup"
                >
                  Sign Up
                </button>
              </div>
            </div>
          </div>
        </nav>

        <!-- banner -->
        <img
          class="index_banner"
          src="image/small_banner.png"
          alt="Banner Image"
        />
      </div>
    </header>

    <!-- main -->
    <main class="max_width_1200">
      <!-- write post -->
      <div class="write_post_main">
        <div class="write_post_title">
          <p>WRITE POST</p>
        </div>

        <!-- Write post title -->
        <div class="write_post_title_box">
          <input
            class="write_post_title_input"
            type="text"
            placeholder="Title"
          />
        </div>

        <!-- toolbar -->

        <!-- Create toolbar container -->
        <div id="toolbar">
          <!-- Add font size dropdown -->
          <select class="ql-size">
            <option value="small"></option>
            <option selected></option>
            <option value="large"></option>
            <option value="huge"></option>
          </select>

          <!-- color related buttons -->
          <span class="ql-formats">
            <select class="ql-color"></select>
            <select class="ql-background"></select>
          </span>

          <!-- Add a format button -->
          <span class="ql-formats">
            <button class="ql-bold"></button>
            <button class="ql-italic"></button>
            <button class="ql-underline"></button>
          </span>

          <span class="ql-formats">
            <button class="ql-list" value="ordered"></button>
            <button class="ql-list" value="bullet"></button>
            <button class="ql-indent" value="-1"></button>
            <button class="ql-indent" value="+1"></button>
            <select class="ql-align"></select>
          </span>

          <span class="ql-formats">
            <button class="ql-image"></button>
          </span>

          <!-- hidden file input for image upload -->
          <input
            type="file"
            id="fileInput"
            style="display: none"
            accept="image/*"
          />
        </div>

        <!-- toolbar editor -->
        <div id="editor"></div>

        <!-- post button -->
        <div class="write_post_button_box">
          <button class="write_post_button">POST</button>
        </div>
      </div>
    </main>

    <!-- footer -->
    <footer class="max_width_1920">
      <div class="footer_content max_width_1200">
        <!-- footer logo -->
        <div class="footer_logo_and_icons">
          <img
            class="footer_logo_photo"
            src="image/logos/Footer_logo.png"
            alt="footer logo"
          />
          <p class="footer_icons">
            <a href="https://www.facebook.com/HabitatUW">FB</a>
            <a href="https://www.instagram.com/h4huw/">IG</a>
            <a href="">TW</a>
            <a href="https://linktr.ee/h4huw">LT</a>
          </p>
        </div>
        <!-- footer contents -->
        <div class="footer_contents">
          <p>
            Humanity Campus Chapter at the University of Wisconsin â€“ Madison
          </p>
          <p>666 Langdon St, Madison WI 53703</p>

          <p>
            <a href="mailto:absed@gmail.com">absed@gmail.com</a>
            <span class="footer_policy">000-000-0000</span>
          </p>

          <p>
            <span><a href="#" class="footer_a_tag">Term of Use</a></span>
            <span class="footer_policy"
              ><a href="#" class="footer_a_tag">Privacy Policy</a></span
            >
          </p>
        </div>
      </div>
    </footer>
  </body>

  <script type="module">
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAq-CkeNE_K765pauvvO-72oAUIGCE_Jpc",
      authDomain: "hfh-uwmadison.firebaseapp.com",
      projectId: "hfh-uwmadison",
      storageBucket: "hfh-uwmadison.appspot.com",
      messagingSenderId: "158190324248",
      appId: "1:158190324248:web:89397ab7a4171eb54e516d",
    };
    firebase.initializeApp(firebaseConfig);

    let auth = firebase.auth();
    let db = firebase.firestore();

    // define a storage reference
    let ref = firebase.storage().ref();
  </script>

  <!-- Include the Quill library -->
  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.0-rc.4/dist/quill.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const quill = new Quill("#editor", {
        modules: {
          toolbar: {
            container: "#toolbar",
            handlers: {
              image: function () {
                // Trigger file input click event
                var fileInput = document.getElementById("fileInput");
                fileInput.click();

                fileInput.onchange = function () {
                  var file = fileInput.files[0];
                  if (file) {
                    // Call function to upload image
                    uploadImage(file)
                      .then(function (url) {
                        // Insert image URL into the editor
                        var range = quill.getSelection();
                        quill.insertEmbed(range.index, "image", url);
                      })
                      .catch(function (error) {
                        console.error("Error uploading image: ", error);
                      });
                  }
                  fileInput.value = ""; // Reset file input
                };
              },
            },
          },
        },
        theme: "snow",
        placeholder: "Write something awesome...",
      });

      // Get the content of the editor when the user clicks the post button
      document
        .querySelector(".write_post_button")
        .addEventListener("click", postContent);

      // function for post the content to the firestore
      function postContent() {
        let title = document.querySelector(".write_post_title_input").value;
        let content = quill.getContents();

        firebase
          .firestore()
          .collection("posts")
          .add({
            title: title,
            content: JSON.stringify(content),
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            username: firebase.auth().currentUser,
          })
          .then(() => {
            alert("Post successfully!");
            //need to change this if we are going to use single page
            window.location.href = "post.html";
          })
          .catch((error) => {
            console.error("Error adding document: ", error);
          });

        //clear the editor and title input
        quill.setContents([]);
        document.querySelector(".write_post_title_input").value = "";
      }
    });

    // Function to upload image to Firebase Storage
    function uploadImage(file) {
      // Create a unique filename for the image
      var uniqueName = "image_" + Date.now();

      // Create a reference to the storage service
      var storageRef = firebase.storage().ref();

      // Create a reference to the file to upload
      var imageRef = storageRef.child("images/" + uniqueName);

      // Upload the file to Firebase Storage
      return imageRef.put(file).then(function (snapshot) {
        // Return the URL of the image
        return snapshot.ref.getDownloadURL();
      });
    }
  </script>

  <!-- app.js -->
  <script src="app.js"></script>
</html>
