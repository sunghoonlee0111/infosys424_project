<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <title>Habitat for Humanity</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Covered+By+Your+Grace&family=Manrope:wght@200..800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- header -->
    <header>
      <div class="header max_width_1920">
        <!-- navbar -->
        <nav class="navbar" role="navigation" aria-label="main navigation">
          <div class="navbar-brand">
            <a href="index.html" class="nav_logo"></a>
            <a
              role="button"
              class="navbar-burger"
              id="burger_nav"
              aria-label="menu"
              aria-expanded="false"
              data-target="navbarBasicExample"
            >
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
            </a>
          </div>
          <div class="navbar-menu" id="menu_nav">
            <div class="navbar-start">
              <a href="index.html" class="navbar-item">HOME</a>
              <a href="about.html" class="navbar-item">ABOUT</a>
              <a href="gallery.html" class="navbar-item">GALLERY</a>
              <a href="post.html" class="navbar-item">POST</a>
              <a href="event.html" class="navbar-item">EVENT</a>
            </div>
            <div class="navbar-end">
              <div class="nav_signin navbar-item">
                <button
                  class="button has-text-black is-rounded"
                  id="user_signin"
                >
                  Sign In
                </button>
              </div>
              <div class="navbar-item">
                <button
                  class="nav_signup button has-text-black is-rounded main-color"
                  id="user_signup"
                >
                  Sign Up
                </button>
              </div>
            </div>
          </div>
        </nav>
        <!-- banner -->
        <img class="index_banner" src="image/Banner.png" alt="Banner Image" />
      </div>
    </header>
    <main class="max_width_1200">
      <!-- gallery -->
      <div class="gallery_main">
        <!-- gallery title -->
        <div class="gallery_title">
          <p>GALLERY</p>
        </div>
        <!-- add pictire button -->

        <div id="add_picture_button_box">
          <button class="button" id="add_picture_button">Add Picture</button>
          <input
            style="display: none"
            class="input"
            type="file"
            id="add_picture_input"
            placeholder="Add Picture"
          />
        </div>

        <!-- gallery content -->
        <div class="gallery_content" id="gallery_pics_container"></div>
      </div>
    </main>

    <!-- footer -->
    <footer class="max_width_1920">
      <div class="footer_content max_width_1200">
        <!-- footer logo -->
        <div class="footer_logo_and_icons">
          <img
            class="footer_logo_photo"
            src="image/logos/Footer_logo.png"
            alt="footer logo"
          />
          <p class="footer_icons">
            <a href="https://www.facebook.com/HabitatUW">FB</a>
            <a href="https://www.instagram.com/h4huw/">IG</a>
            <a href="">TW</a>
            <a href="https://linktr.ee/h4huw">LT</a>
          </p>
        </div>
        <!-- footer contents -->
        <div class="footer_contents">
          <p>
            Humanity Campus Chapter at the University of Wisconsin â€“ Madison
          </p>
          <p>666 Langdon St, Madison WI 53703</p>
          <p>
            <a href="mailto:absed@gmail.com">absed@gmail.com</a>
            <span class="footer_policy">000-000-0000</span>
          </p>
          <p>
            <span><a href="#" class="footer_a_tag">Term of Use</a></span>
            <span class="footer_policy"
              ><a href="#" class="footer_a_tag">Privacy Policy</a></span
            >
          </p>
        </div>
      </div>
    </footer>
  </body>

  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-storage.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-firestore.js"></script>

  <!-- Include the Quill library -->
  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.0-rc.4/dist/quill.js"></script>

  <script type="module">
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAq-CkeNE_K765pauvvO-72oAUIGCE_Jpc",
      authDomain: "hfh-uwmadison.firebaseapp.com",
      projectId: "hfh-uwmadison",
      storageBucket: "hfh-uwmadison.appspot.com",
      messagingSenderId: "158190324248",
      appId: "1:158190324248:web:89397ab7a4171eb54e516d",
    };
    firebase.initializeApp(firebaseConfig);

    async function addPicture() {
      let input = document.getElementById("add_picture_input");
      input.click();

      // Define the event listener function
      const handleFileChange = async (e) => {
        let file = e.target.files[0];
        if (file.type.split("/")[0] !== "image") {
          alert("Please upload a picture");
          input.value = ""; // Empty the input
          return;
        }

        let timestamp = new Date();
        let storageRef = firebase.storage().ref();
        let fileRef = storageRef.child(`gallery_images/${timestamp}`);
        await fileRef.put(file);
        let url = await fileRef.getDownloadURL();
        console.log(timestamp, url);
        input.value = ""; // Empty the input

        // Save URL and timestamp to Firestore DB
        let db = firebase.firestore();
        db.collection("gallery").add({
          url: url,
          timestamp: timestamp,
        });

        // Display the pictures
        displayPictures();

        // Remove the event listener to prevent it from firing multiple times
        input.removeEventListener("change", handleFileChange);
      };

      // Add the event listener
      input.addEventListener("change", handleFileChange);
    }

    //function to display the pictures
    function displayPictures() {
      let html = ``;
      let storageRef = firebase.storage().ref();
      let galleryRef = storageRef.child("gallery_images");

      //get url from gallery db and add to html
      let db = firebase.firestore();
      db.collection("gallery")
        .orderBy("timestamp", "desc")
        .onSnapshot((e) => {
          e.forEach((doc) => {
            let data = doc.data();
            html += `<img class="gallery_pics" src="${data.url}" value="${data.timestamp}" alt="gallery photo" />`;
          });
          document.getElementById("gallery_pics_container").innerHTML = html;
        });
    }

    // Add Picture Button
    document
      .getElementById("add_picture_button")
      .addEventListener("click", () => {
        //choose file to upload
        addPicture();
      });

    //display pictures
    displayPictures();
  </script>

  <script src="app.js"></script>
</html>
