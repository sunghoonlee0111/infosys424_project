<!DOCTYPE html>
<html>
  <head>
    <title>Quill Editor with Image Upload</title>
    <!-- Include Quill stylesheet -->
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="toolbar">
      <!-- Your toolbar elements go here -->
    </div>
    <div id="editor"></div>
    <div class="write_post_button_box">
      <button class="write_post_button">POST</button>
    </div>

    <!-- Hidden file input for image uploads -->
    <input type="file" id="fileInput" style="display: none" accept="image/*" />

    <!-- Include Quill library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
      // Ensure this code runs only after the document is fully loaded
      document.addEventListener("DOMContentLoaded", function () {
        var quill = new Quill("#editor", {
          theme: "snow",
          modules: {
            toolbar: "#toolbar",
          },
        });

        // Custom button for image upload
        var toolbar = quill.getModule("toolbar");
        toolbar.addHandler("image", function () {
          var fileInput = document.getElementById("fileInput");
          if (fileInput) {
            fileInput.addEventListener("change", function () {
              var file = fileInput.files[0];
              if (file) {
                // Handle the file, upload it to your server, and insert the image URL
                console.log("File selected", file);
                // This is where you would implement the upload functionality
              }
            });

            fileInput.click();
          }
        });

        // Create custom toolbar options with the image upload button
        var toolbarOptions = [
          ["bold", "italic", "underline", "strike"], // toggled buttons
          ["blockquote", "code-block"],

          [{ header: 1 }, { header: 2 }], // custom button values
          [{ list: "ordered" }, { list: "bullet" }],
          [{ script: "sub" }, { script: "super" }], // superscript/subscript
          [{ indent: "-1" }, { indent: "+1" }], // outdent/indent
          [{ direction: "rtl" }], // text direction

          [{ size: ["small", false, "large", "huge"] }], // custom dropdown
          [{ header: [1, 2, 3, 4, 5, 6, false] }],

          [{ color: [] }, { background: [] }], // dropdown with defaults from theme
          [{ font: [] }],
          [{ align: [] }],

          ["clean"], // remove formatting button

          ["link", "image", "video"], // link and image, video
        ];

        quill.toolbar.container.innerHTML = "";
        quill.theme.modules.toolbar = toolbarOptions;
      });
    </script>
  </body>

  <script>
    document
      .querySelector(".write_post_button")
      .addEventListener("click", () => {
        let title = document.querySelector(".write_post_title_input").value;

        let content = document.querySelector(".ql-editor").innerHTML;

        //get Detla object of the content
        let delta = quill.getContents();
        let text = quill.getText();

        console.log(delta);
        console.log(text);

        console.log(title);
        console.log(content);

        firebase
          .firestore()
          .collection("posts")
          .add({
            title: title,
            content: content,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            username: firebase.auth().currentUser,
          })
          .then(() => {
            alert("Post successfully!");
            //need to change this if we are going to use single page
            window.location.href = "post.html";
          })
          .catch((error) => {
            console.error("Error adding document: ", error);
          });

        // clear the input
        document.querySelector(".write_post_title_input").value = "";
        document.querySelector(".ql-editor").innerHTML = "";
      });
  </script>
</html>
